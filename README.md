# CI-Board - æ‚é±¼ä¸»äººä¹Ÿèƒ½ç”¨çš„é«˜æ€§èƒ½å‰ªè´´æ¿ç›‘æ§åº“

![CI/CD](https://github.com/Xuehua-Meaw/ci_board/actions/workflows/ci_board_CICD.yml/badge.svg)

> æ‚é±¼â™¡ï½è¿™å¯æ˜¯æœ¬å–µä¸ºæ‚é±¼ä¸»äººç²¾å¿ƒè®¾è®¡çš„ Windows å‰ªè´´æ¿ç›‘æ§åº“å–µï½

## ğŸ¯ é¡¹ç›®æ¦‚è§ˆ

**CI-Board** (Clipboard Intelligence Board) æ˜¯ä¸€ä¸ªä¸º Windows è®¾è®¡çš„é«˜æ€§èƒ½ Python å‰ªè´´æ¿ç›‘æ§åº“ã€‚å®ƒä¸ä»…èƒ½å®æ—¶æ•è·æ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤šç§å‰ªè´´æ¿å†…å®¹ï¼Œè¿˜èƒ½æ™ºèƒ½è¿½è¸ªå†…å®¹çš„æ¥æºåº”ç”¨ç¨‹åºï¼Œå“¼ï½æ˜¯ä¸æ˜¯å¾ˆå‰å®³å–µï¼ï½

### âœ¨ æ ¸å¿ƒç‰¹æ€§
- ğŸ± **æ‡’äººAPI** - åªéœ€ä¸€è¡Œä»£ç å°±èƒ½æ·»åŠ å¤„ç†å™¨ï¼Œæœ¬å–µéƒ½å¸®ä½ å¼„å¥½äº†å–µï½
- ğŸ”„ **å®æ—¶ç›‘æ§** - åŸºäº Windows åŸç”Ÿæ¶ˆæ¯çš„äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼Œé«˜æ•ˆåˆçµæ•ï¼
- ğŸ¯ **æ™ºèƒ½æºè¿½è¸ª** - èƒ½å‡†ç¡®è¯†åˆ«æ˜¯å“ªä¸ªç¨‹åºï¼ˆæ¯”å¦‚ `vscode.exe` æˆ– `explorer.exe`ï¼‰å¤åˆ¶äº†å†…å®¹å–µã€‚
- ğŸ“‹ **å¤šæ ¼å¼æ”¯æŒ** - åŸç”Ÿæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡å’Œæ–‡ä»¶åˆ—è¡¨ï¼Œæ‚é±¼ä¸»äººä¸ç”¨å†è‡ªå·±è§£æäº†ã€‚
- âš¡ **çœŸÂ·å¼‚æ­¥å¤„ç†** - ä½¿ç”¨ç‹¬ç«‹çš„çº¿ç¨‹æ± å¤„ç†å›è°ƒï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå°±ç®—æ‚é±¼ä¸»äººå†™å‡ºå¾ˆæ…¢çš„ä»£ç ä¹Ÿä¸ä¼šå¡ä½å–µï¼
- ğŸ›¡ï¸ **é«˜çº§å»é‡** - å†…ç½®æ™ºèƒ½å“ˆå¸Œå’ŒæŒ‡çº¹ç®—æ³•ï¼Œèƒ½æœ‰æ•ˆè¿‡æ»¤å› å¤šæ­¥éª¤æ“ä½œï¼ˆå¦‚æˆªå›¾ã€ç¼–è¾‘ã€å¤åˆ¶ï¼‰äº§ç”Ÿçš„é‡å¤å†…å®¹ã€‚
- ğŸ”Œ **é«˜æ‰©å±•æ€§** - å¤„ç†å™¨å’Œè¿‡æ»¤å™¨éƒ½å¯ä»¥è‡ªå®šä¹‰ï¼Œæƒ³æ€ä¹ˆç©éƒ½è¡Œï¼Œå“¼ï½
- ğŸ“ **è¯¦ç»†æ—¥å¿—** - å†…ç½®æ—¥å¿—ç³»ç»Ÿï¼Œæ–¹ä¾¿æ‚é±¼ä¸»äººè°ƒè¯•æ—¶æŸ¥çœ‹å†…éƒ¨çŠ¶æ€ã€‚

### ğŸ“Š é¡¹ç›®ä¿¡æ¯
- **ç‰ˆæœ¬**: v0.0.7
- **Pythonç‰ˆæœ¬**: >=3.8
- **å¹³å°**: Windows
- **ä¾èµ–**: çº¯Pythonï¼Œæ— å¼ºåˆ¶ç¬¬ä¸‰æ–¹ä¾èµ–
- **è®¸å¯è¯**: MIT

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…
```bash
# æ‚é±¼â™¡ï½æ¨èä½¿ç”¨æœ¬å–µæœ€å–œæ¬¢çš„ uv åŒ…ç®¡ç†å™¨å–µï½
uv add ci-board

# æˆ–è€…ç”¨ä½ é‚£æ…¢ååçš„ pip
pip install ci-board
```
> **å¯é€‰ä¾èµ–**: å¦‚æœè¦å¤„ç†å›¾ç‰‡ï¼Œæœ¬å–µå»ºè®®ä½ å®‰è£… `Pillow` åº“å–µï½ `uv add pillow` æˆ– `pip install Pillow`

### æ‡’äººAPI - 30ç§’ä¸Šæ‰‹
å“¼ï½çœ‹å¥½äº†ï¼Œæ‚é±¼ä¸»äººï¼è¿™å°±æ˜¯æœ¬å–µè®¾è®¡çš„æ‡’äººAPIï¼Œè®©ä½ è¿™ç§æ‡’è›‹ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹å–µï½

```python
# æ‚é±¼â™¡ï½è¿™æ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼å–µï½
import time
from ci_board import create_monitor, ProcessInfo, BMPData
# æ‚é±¼â™¡ï½ä¸ºäº†çœ‹æ¸…æœ¬å–µçš„å·¥ä½œè¿‡ç¨‹ï¼Œå¯ä»¥æ‰“å¼€æ—¥å¿—å–µï½
from ci_board.utils import setup_ci_board_logging, LogLevel
setup_ci_board_logging(console_level=LogLevel.INFO)

def on_text_change(text: str, source: ProcessInfo):
    print(f"æ‚é±¼â™¡ï½æœ¬å–µæŠ“åˆ°äº†æ–°çš„æ–‡æœ¬å–µï¼æ˜¯ä» [{source.process_name}] æ¥çš„ï¼")
    print(f"  å†…å®¹: {text[:80]}...")

def on_image_change(image: BMPData, source: ProcessInfo):
    print(f"æ‚é±¼â™¡ï½æŠ“åˆ°ä¸€å¼ å›¾ç‰‡ï¼å°ºå¯¸ {image.width}x{image.height}ï¼Œæ¥è‡ª [{source.process_name}] å–µï¼")
    # æ‚é±¼â™¡ï½æƒ³çœ‹å›¾çš„è¯ï¼Œè®°å¾—å…ˆå®‰è£… Pillow å–µï½
    try:
        import io
        from PIL import Image
        img = Image.open(io.BytesIO(image.data))
        img.show()
    except ImportError:
        print("  ï¼ˆæ‚é±¼ä¸»äººå¿«å»å®‰è£… Pillow æ‰èƒ½çœ‹å›¾å–µï¼ï¼‰")
    except Exception as e:
        print(f"  ï¼ˆå“å‘€ï¼Œå›¾ç‰‡å‡ºé”™äº†å–µï¼š{e}ï¼‰")

def on_files_change(files: list[str], source: ProcessInfo):
    print(f"æ‚é±¼â™¡ï½æœ‰æ–‡ä»¶è¢«å¤åˆ¶äº†å–µï¼ä¸€å…± {len(files)} ä¸ªï¼Œæ¥è‡ª [{source.process_name}]ï¼")
    for f in files:
        print(f"  - {f}")

# å“¼ï½åˆ›å»ºç›‘æ§å™¨ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•å–µï½
monitor = create_monitor()

# æ‚é±¼â™¡ï½çœ‹å¥½äº†ï¼Œæœ¬å–µçš„æ‡’äººAPIå¯ä»¥ç›´æ¥æŠŠå‡½æ•°å˜æˆå¤„ç†å™¨å–µï¼
monitor.add_handler('text', on_text_change)
monitor.add_handler('image', on_image_change)
monitor.add_handler('files', on_files_change)

print("æ‚é±¼â™¡ï½ç›‘æ§å¼€å§‹äº†å–µï¼å¿«å»å¤åˆ¶ç‚¹ä¸œè¥¿ç»™æœ¬å–µçœ‹çœ‹ï¼(æŒ‰ Ctrl+C ç»“æŸ)")
monitor.start()

try:
    monitor.wait()
except KeyboardInterrupt:
    print("\nå“¼ï½æ‚é±¼ä¸»äººä¸ç©äº†ï¼Œé‚£æœ¬å–µå°±ç»“æŸäº†å–µï½")
finally:
    monitor.stop()

```

## ğŸ“‹ API æ–‡æ¡£

### `create_monitor()`
è¿™æ˜¯æœ€ç®€å•çš„åˆ›å»ºç›‘æ§å™¨çš„æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé…ç½®å¥½é»˜è®¤å‚æ•°çš„ `ClipboardMonitor` å®ä¾‹ã€‚

### `ClipboardMonitor` æ ¸å¿ƒç±»
```python
class ClipboardMonitor:
    def __init__(self, 
                 async_processing: bool = True,     # å“¼ï½é»˜è®¤å½“ç„¶æ˜¯å¼‚æ­¥å¤„ç†å–µ
                 max_workers: int = 4,              # æ‚é±¼â™¡ï½æœ¬å–µç»™ä½ å‡†å¤‡äº†4ä¸ªå·¥äººå¤„ç†å›è°ƒ
                 handler_timeout: float = 30.0,     # è¦æ˜¯å“ªä¸ªå¤„ç†å™¨å¤ªæ…¢ï¼Œ30ç§’æœ¬å–µå°±ä¸è¦å®ƒäº†
                 event_driven: bool = True):        # äº‹ä»¶é©±åŠ¨ï¼æœ€é«˜æ•ˆçš„æ¨¡å¼å–µï¼
    
    # --- åŸºæœ¬æ§åˆ¶ ---
    def start() -> bool:          # å¯åŠ¨ç›‘æ§ï¼Œå“¼ï½
    def stop() -> None:           # åœæ­¢ç›‘æ§ï¼ŒçœŸæ˜¯çš„ï¼Œè¯´åœå°±åœ
    def wait() -> None:           # é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°ç›‘æ§åœæ­¢ï¼Œæ‚é±¼ä¸»äººå°±å–œæ¬¢å¹²ç­‰ç€
    def is_running() -> bool:     # å‘Šè¯‰æ‚é±¼ä¸»äººæœ¬å–µæ˜¯ä¸æ˜¯åœ¨å·¥ä½œ
    
    # --- å¤„ç†å™¨ç®¡ç† (æ‡’äººAPI) ---
    def add_handler(content_type: str, callback: Callable) -> BaseClipboardHandler:
        # æ·»åŠ å¤„ç†å™¨ï¼Œä¼ å…¥å›è°ƒå‡½æ•°å°±è¡Œï¼Œæœ¬å–µä¼šå¸®ä½ æå®šå‰©ä¸‹çš„
    
    def remove_handler(content_type: str, handler: BaseClipboardHandler) -> None:
        # å“¼ï¼Œä¸æƒ³è¦äº†å°±ä¸¢æ‰
    
    def clear_handlers(content_type: str | None = None) -> None:
        # å…¨éƒ¨ä¸¢æ‰ï¼çœ¼ä¸è§å¿ƒä¸çƒ¦ï¼
    
    # --- çŠ¶æ€ä¸é…ç½® ---
    def get_status() -> dict:     # çœ‹çœ‹æœ¬å–µå·¥ä½œçš„æ€ä¹ˆæ ·äº†
    def enable_source_tracking() -> None:   # å¯ç”¨æºè¿½è¸ªï¼ˆé»˜è®¤å¼€å¯ï¼‰
    def disable_source_tracking() -> None:  # ç¦ç”¨æºè¿½è¸ª
```

### å†…å®¹ç±»å‹ä¸å›è°ƒ
| ç±»å‹ | æè¿° | å›è°ƒå‚æ•° `(content, source_info)` |
| :--- | :--- | :--- |
| `'text'` | æ–‡æœ¬å†…å®¹ | `(text: str, source: ProcessInfo)` |
| `'image'` | BMP å›¾ç‰‡æ•°æ® | `(bmp_data: BMPData, source: ProcessInfo)` |
| `'files'` | æ–‡ä»¶è·¯å¾„åˆ—è¡¨ | `(file_list: list[str], source: ProcessInfo)` |
| `'update'`| ä»»æ„å†…å®¹æ›´æ–°| `(data: tuple, source: ProcessInfo)` |

`'update'` ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ `content` æ˜¯ä¸€ä¸ªå…ƒç»„ `(content_type, actual_content)`ï¼Œä»»ä½•ç±»å‹çš„å‰ªè´´æ¿æ›´æ–°éƒ½ä¼šè§¦å‘å®ƒã€‚å“¼ï½ç»™é«˜çº§ç”¨æˆ·å‡†å¤‡çš„ï¼Œæ‚é±¼ä¸»äººå¯èƒ½ç”¨ä¸ä¸Šã€‚

### æ ¸å¿ƒæ•°æ®ç»“æ„
å“¼ï½è¿™äº›æ˜¯å›è°ƒå‡½æ•°ä¼šæ”¶åˆ°çš„æ•°æ®ç»“æ„ï¼Œç»™æœ¬å–µçœ‹ä»”ç»†äº†ï¼

```python
# æ¥æºè¿›ç¨‹ä¿¡æ¯ï¼Œæœ¬å–µæŸ¥åˆ°çš„å¯è¯¦ç»†äº†å–µï¼
class ProcessInfo:
    process_name: str       # è¿›ç¨‹å, åƒ 'vscode.exe'
    process_path: str       # å®Œæ•´è·¯å¾„
    process_id: int         # è¿›ç¨‹ID
    window_title: str       # çª—å£æ ‡é¢˜
    detection_method: str   # æœ¬å–µæ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•æŠ“åˆ°å®ƒçš„
    confidence_level: str   # æœ¬å–µå¯¹ç»“æœçš„è‡ªä¿¡ç¨‹åº¦ï¼Œå“¼ï½
    is_system_process: bool # æ˜¯ä¸æ˜¯ç³»ç»Ÿè¿›ç¨‹
    is_screenshot_tool: bool # æ˜¯ä¸æ˜¯æˆªå›¾å·¥å…·ï¼Œæœ¬å–µå¯èªæ˜äº†
    timestamp: float        # å‘ç°å®ƒçš„æ—¶é—´æˆ³

# BMPå›¾ç‰‡æ•°æ®ï¼Œæ‰...æ‰ä¸æ˜¯ä¸ºäº†æ‚é±¼ä¼˜åŒ–çš„ä»£ç â™¡ï½
class BMPData:
    success: bool           # è½¬æ¢æ˜¯å¦æˆåŠŸ
    data: bytes | None      # BMP æ ¼å¼çš„å›¾ç‰‡æ•°æ®
    width: int              # å›¾ç‰‡å®½åº¦
    height: int             # å›¾ç‰‡é«˜åº¦
```

## ğŸ›¡ï¸ é«˜çº§ç”¨æ³•

### å¯¹å¤„ç†å™¨è¿›è¡Œç²¾ç»†é…ç½®
`add_handler` ä¼šè¿”å›ä¸€ä¸ªå¤„ç†å™¨å®ä¾‹ï¼Œæ‚é±¼ä¸»äººå¯ä»¥å¯¹å®ƒè¿›è¡Œè¿›ä¸€æ­¥é…ç½®ï¼Œæ¯”å¦‚æ·»åŠ è¿‡æ»¤å™¨ã€‚

```python
from ci_board.handlers import TextHandler

monitor = create_monitor()

# å“¼ï½è™½ç„¶æ˜¯æ‡’äººAPIï¼Œä½†æœ¬å–µä¹Ÿå…è®¸ä½ è¿›è¡Œé«˜çº§æ“ä½œ
text_handler = monitor.add_handler('text', my_text_callback)

# å°±...å°±å…è®¸ä½ å¯¹å®ƒåŠ ä¸ªè¿‡æ»¤å™¨å¥½äº†
text_handler.set_length_filter(min_length=10) # å¤ªçŸ­çš„æ–‡æœ¬æœ¬å–µæ‰ä¸å…³å¿ƒ
text_handler.set_source_filter(
    allowed_processes=['notepad.exe', 'Code.exe'] # åªå…³å¿ƒè®°äº‹æœ¬å’ŒVSCode
)

# æœ¬å–µè¿è¿™ç§è¾¹ç¼˜æƒ…å†µéƒ½æƒ³åˆ°äº†ï¼Œæ‚é±¼ä¸»äººåº”è¯¥æ„Ÿæ©å–µï½ï½
def custom_filter(text: str, source: ProcessInfo) -> bool:
    return "secret" not in text.lower()

text_handler.add_filter(custom_filter) # æ‰...æ‰ä¸æ˜¯ä¸ºäº†å¸®ä½ è¿‡æ»¤ç§˜å¯†ä¿¡æ¯â™¡ï½
```

### æŸ¥çœ‹æœ¬å–µçš„å·¥ä½œçŠ¶æ€
æƒ³çŸ¥é“æœ¬å–µåœ¨å¹²ä»€ä¹ˆå—ï¼Ÿ`get_status()` å¯ä»¥æ»¡è¶³ä½ è¿™ä¸ªå˜æ€ä¸»äººçš„å·çª¥æ¬²â™¡ï½
```python
# å¯åŠ¨å...
status = monitor.get_status()

import json
print(json.dumps(status, indent=2))
```
ä½ ä¼šçœ‹åˆ°æœ¬å–µçš„å„ç§å·¥ä½œçŠ¶æ€ï¼Œæ¯”å¦‚å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°ã€å»é‡ç¼“å­˜çš„æ•°é‡ã€ç„¦ç‚¹è¿½è¸ªçš„çŠ¶æ€ç­‰ç­‰ï¼Œå“¼ï½æœ¬å–µå¯æ˜¯ä¸€ç›´åœ¨åŠªåŠ›å·¥ä½œï¼

## ğŸ“ é¡¹ç›®ç»“æ„
```
ci_board/
â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—ï¼Œæœ¬å–µçš„å¿ƒè„ï¼
â”‚   â”œâ”€â”€ monitor.py          # ä¸»ç›‘æ§å™¨
â”‚   â””â”€â”€ source_tracker_.py  # æºè¿½è¸ªå™¨ï¼Œæœ¬å–µçš„çœ¼ç›ï¼
â”œâ”€â”€ handlers/               # å¤„ç†å™¨ï¼Œå¸®æ‚é±¼ä¸»äººå¹²æ´»çš„
â”‚   â”œâ”€â”€ text_handler.py
â”‚   â”œâ”€â”€ image_handler.py
â”‚   â””â”€â”€ file_handler.py
â”œâ”€â”€ interfaces/             # æ¥å£å®šä¹‰ï¼Œè¿™æ˜¯è§„çŸ©
â”œâ”€â”€ types/                  # æ•°æ®ç±»å‹ï¼Œæœ¬å–µçš„è¯­è¨€
â””â”€â”€ utils/                  # å·¥å…·æ¨¡å—ï¼Œæœ¬å–µçš„å·¥å…·ç®±
    â”œâ”€â”€ clipboard_utils.py  # å‰ªè´´æ¿å·¥å…·ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
    â”œâ”€â”€ win32_api.py        # Windows API å°è£…
    â””â”€â”€ logger.py           # æ—¥å¿—å·¥å…·
```

## ğŸ“ å¼€å‘ä¿¡æ¯

- **ä½œè€…**: StanleyUKN
- **GitHub**: [ci_board](https://github.com/Xuehua-Meaw/ci_board)
- **è®¸å¯è¯**: MIT License

## ğŸ’ è‡´è°¢

å“¼ï½æ„Ÿè°¢æ‰€æœ‰ä½¿ç”¨æœ¬å–µä½œå“çš„æ‚é±¼ä¸»äººä»¬å–µï½
å¦‚æœè§‰å¾—å¥½ç”¨...å°±...å°±ç»™æœ¬å–µä¸€ä¸ª Star å§ï¼æ‰...æ‰ä¸æ˜¯å› ä¸ºæƒ³è¦æ‰è·Ÿä½ è¦çš„ï¼åªæ˜¯çœ‹ä½ å¯æ€œè€Œå·²ï¼â™¡ï½
